<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>koa2 +MongoDB从0到1，实现与数据库交互。 | willwang&#39;s blog</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="alternate" type="application/rss+xml" href="https://willwang1997.github.io/rss.xml" title="willwang&#39;s blog RSS Feed">
    <link rel="alternate" type="application/atom+xml" href="https://willwang1997.github.io/feed.atom" title="willwang&#39;s blog Atom Feed">
    <link rel="alternate" type="application/json" href="https://willwang1997.github.io/feed.json" title="willwang&#39;s blog JSON Feed">
    <meta name="description" content="Just playing">
    
    <link rel="preload" href="/assets/css/0.styles.cbfab61f.css" as="style"><link rel="preload" href="/assets/js/app.34a60fde.js" as="script"><link rel="preload" href="/assets/js/4.969febe7.js" as="script"><link rel="preload" href="/assets/js/34.ab906998.js" as="script"><link rel="prefetch" href="/assets/js/1.d1dca994.js"><link rel="prefetch" href="/assets/js/10.f5d3e969.js"><link rel="prefetch" href="/assets/js/11.b91548bc.js"><link rel="prefetch" href="/assets/js/12.a66d49af.js"><link rel="prefetch" href="/assets/js/13.e2a71aa1.js"><link rel="prefetch" href="/assets/js/14.d2686aab.js"><link rel="prefetch" href="/assets/js/18.d944fc03.js"><link rel="prefetch" href="/assets/js/19.284919a4.js"><link rel="prefetch" href="/assets/js/2.46b74bbe.js"><link rel="prefetch" href="/assets/js/20.b2427a0d.js"><link rel="prefetch" href="/assets/js/21.94b486eb.js"><link rel="prefetch" href="/assets/js/22.5183c59c.js"><link rel="prefetch" href="/assets/js/23.cdec4004.js"><link rel="prefetch" href="/assets/js/24.d1a98730.js"><link rel="prefetch" href="/assets/js/25.311fb5f2.js"><link rel="prefetch" href="/assets/js/26.8c708c03.js"><link rel="prefetch" href="/assets/js/27.4a2bf80a.js"><link rel="prefetch" href="/assets/js/28.3b0c2365.js"><link rel="prefetch" href="/assets/js/29.1b61d418.js"><link rel="prefetch" href="/assets/js/3.c33bd55a.js"><link rel="prefetch" href="/assets/js/30.fb06f297.js"><link rel="prefetch" href="/assets/js/31.993c3292.js"><link rel="prefetch" href="/assets/js/32.3576d727.js"><link rel="prefetch" href="/assets/js/33.b1e3af00.js"><link rel="prefetch" href="/assets/js/35.22861bdc.js"><link rel="prefetch" href="/assets/js/36.8f3d0366.js"><link rel="prefetch" href="/assets/js/37.d8fc1323.js"><link rel="prefetch" href="/assets/js/38.f8732295.js"><link rel="prefetch" href="/assets/js/39.5a2724f0.js"><link rel="prefetch" href="/assets/js/40.8e9cf48a.js"><link rel="prefetch" href="/assets/js/41.790e83d1.js"><link rel="prefetch" href="/assets/js/42.75ce6882.js"><link rel="prefetch" href="/assets/js/5.4639319b.js"><link rel="prefetch" href="/assets/js/6.17900bec.js"><link rel="prefetch" href="/assets/js/7.bcebdff7.js"><link rel="prefetch" href="/assets/js/8.c75ec882.js"><link rel="prefetch" href="/assets/js/9.d7a7560d.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.7ab33665.js"><link rel="prefetch" href="/assets/js/vuejs-paginate.eacdba44.js">
    <link rel="stylesheet" href="/assets/css/0.styles.cbfab61f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="vuepress-theme-blog__global-layout"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/avart.jpeg" alt="willwang's blog" class="logo"> <span class="site-name can-hide">willwang's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://github.com/willwang1997" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://juejin.cn/user/3456520288480792" target="_blank" rel="noopener noreferrer" class="nav-link external">
  掘金
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://willwang1997.github.io/rss.xml" target="_blank" rel="noopener noreferrer" class="nav-link external">
  RSS
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="mailto:942345396@qq.com" class="nav-link external">
  邮箱
  <!----></a></div> <!----></nav> <div class="black-them"><p href class="nav-link"></p></div></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://github.com/willwang1997" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://juejin.cn/user/3456520288480792" target="_blank" rel="noopener noreferrer" class="nav-link external">
  掘金
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://willwang1997.github.io/rss.xml" target="_blank" rel="noopener noreferrer" class="nav-link external">
  RSS
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="mailto:942345396@qq.com" class="nav-link external">
  邮箱
  <!----></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/" aria-current="page" class="sidebar-link">文章</a></li><li><a href="/category/" class="sidebar-link">分类</a></li><li><a href="/talk/" class="sidebar-link">说说</a></li><li><a href="/message/" class="sidebar-link">留言板</a></li><li><a href="https://500px.com.cn/willwangPic" target="_blank" rel="noopener noreferrer" class="sidebar-link">摄影相册<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li><a href="/fLink/" class="sidebar-link">友情链接</a></li><li><a href="/about/" class="sidebar-link">关于</a></li></ul> </aside></div> <div class="content-wrapper"><div id="vuepress-theme-blog__post-layout"><article class="vuepress-blog-theme-content"><header><h1 itemprop="name headline" class="post-title">
        koa2 +MongoDB从0到1，实现与数据库交互。
      </h1> <div class="post-meta"><div itemprop="publisher author" itemtype="http://schema.org/Person" itemscope="itemscope" class="post-meta-author"><span itemprop="name">willwang</span> <span itemprop="address">   in hunan</span></div> <div class="post-meta-date"><time pubdate itemprop="datePublished" datetime="2020-12-15T00:00:00.000Z" class="date-time">
    创建于：2020-12-15
    </time>
    更新于：<time pubdate itemprop="datePublished" datetime="2020-12-15T00:00:00.000Z">
      2024-01-25
    </time></div> <ul itemprop="keywords" class="post-meta-tags"><div class="post-tag default" data-v-063213ea><a href="/category/DataBase" data-v-063213ea><span data-v-063213ea>DataBase</span></a></div><div class="post-tag default" data-v-063213ea><a href="/category/koa2" data-v-063213ea><span data-v-063213ea>koa2</span></a></div></ul></div></header> <div itemprop="articleBody" class="content__default"><h2 id="windows-mongodb环境配置"><a href="#windows-mongodb环境配置" class="header-anchor"></a> Windows MongoDB环境配置</h2> <p>MongoDB的搭建，第一次在公司电脑下载MongoDB的时候出了一个问题解决了很久。

下载安装的是 <a href="https://www.mongodb.com/try/download/community" target="_blank" rel="noopener noreferrer">社区版本4.0+ （点击下载）<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，然后安装过程中总是报：</p> <p><img src="https://fastly.jsdelivr.net/gh/willwang1997/picMap@main/20180930095421630.png" alt="sad"></p> <div class="language- extra-class"><pre class="language-text"><code>。。。。failed to start Verify that you have sufficient privileges to start system services
</code></pre></div><p>最后的找到的原因是，电脑（win10）的系统远程服务没有配置，what the fuck，我一直以为是安装环境没弄好，或者windows没有激活的原因。</p> <ol><li>首先完全卸载MongoDB,可以根据以下两个方式去检查是否完全卸载干净
1.1.如果你安装过MongoDB，再次安装时出现这个错误（请先确保已经完全卸载了MongoDB），这可能是MongoDB服务的注册表没有删除干净。在“运行”里面输入“regedit”打开注册表编辑器，打开“HKEY_LOCAL_MACHINE\SYSTEM\”，找到CurrentControlSet，会有001，002的后缀多个，都打开找到Services打开，在里面找MongoDB，如果有就删除。重新安装就不会有这种错误。
1.2.如果报的错误是Service ‘MongoDB Server’(MongoDB) failed to install，就是MongoDB服务没有删除，打开计算机—管理，在服务里可以看到MongoDB Server在，就在控制台输入sc delete MongoDB关闭，然后删除掉就可以（需要管理员权限），然后再重启电脑。</li> <li>接下来就是需要重新添加电脑的远程服务设置，
<blockquote><p>此电脑——管理——本地用户和组——组——双击Administrator——添加——高级——立即查找——添加NETWORK SERVICE——确认——应用
参考链接：<a href="https://jingyan.baidu.com/article/90bc8fc8207edeb753640ca3.html" target="_blank" rel="noopener noreferrer">错误1053的解决办法<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p></blockquote></li> <li>然后再重新安装 MongoDB，就不会报最开始的错误了。</li></ol> <p>参考链接：
<a href="https://blog.csdn.net/muguli2008/article/details/80591256" target="_blank" rel="noopener noreferrer">WindowsMongoDB下载、安装、配置、使用<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <h2 id="macos-mongodb的环境配置"><a href="#macos-mongodb的环境配置" class="header-anchor"></a> macOs MongoDB的环境配置</h2> <ol><li>从官网下载的是一个压缩包，解压后放入/usr/local，打开Finder后按 shift + command +G 输入 /usr/local 后回车便能看到这个隐藏的目录了。</li> <li>配置环境变量，打开终端，输入“open -e .bash_profile”，在打开的文件中加入<div class="language- extra-class"><pre class="language-text"><code>export PATH=${PATH}:/usr/local/MongoDB/bin
</code></pre></div></li> <li>Command+S保存配置，在终端输入&quot;source .bash_profile&quot;使配置生效。输入&quot;mongod -version&quot;，回车后如果看到下面的版本号则说明MongoDB已经成功安装到了Mac上。</li> <li>在 “/usr/local/mongoDB“目录先创建log和data文件夹。</li> <li>在终端中，先进入/usr/local/mongoDB ，输入&quot;mongod --dbpath data --logpath log/mongod.log --logappend&quot;，启动mongodb服务(当前终端不要关闭)；可以选择在mac根目录(即Macintosh HD)中创建/data/db，需要重启电脑时候配置。
<blockquote><p>如果改变data目录位置，则需要在启动服务时 指定dbpath的位置。
--dbpath 指定为刚才创建好的data目录
--logpath 指定log存放位置
--logappend mongo在后台运行</p></blockquote></li> <li>新的终端中输入&quot;mongo&quot; 连接数据库,如果终端出现了以下信息，则说明链接成功。（uuid我这个是设置了超级管理员，默认是所有权限）。</li></ol> <div class="language- extra-class"><pre class="language-text"><code>MongoDB shell version v4.4.6
connecting to: mongodb://127.0.0.1:27017/?compressors=disabled&amp;gssapiServiceName=mongodb
Implicit session: session { &quot;id&quot; : UUID(&quot;********************************&quot;) }
MongoDB server version: 4.4.6
---
    Enable MongoDB's free cloud-based monitoring service, which will then receive and display
    metrics about your deployment (disk utilization, CPU, operation statistics, etc).

    The monitoring data will be available on a MongoDB website with a unique URL accessible to you
    and anyone you share the URL with. MongoDB may use this information to make product
    improvements and to suggest MongoDB products and deployment options to you.

    To enable free monitoring, run the following command: db.enableFreeMonitoring()
    To permanently disable this reminder, run the following command: db.disableFreeMonitoring()

</code></pre></div><p>参考友情链接：
<a href="https://zhuanlan.zhihu.com/p/112263843" target="_blank" rel="noopener noreferrer">macOs安装的步骤知乎<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>；
<a href="https://www.jianshu.com/p/a594e6482e5c" target="_blank" rel="noopener noreferrer">macOs安装的步骤简书<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>；</p> <h2 id="koa创建项目"><a href="#koa创建项目" class="header-anchor"></a> koa创建项目</h2> <p>因为是基于node，先创建一个文件夹，进入文件夹后打开终端，输入<code>node init</code>开始初始化一个node项目（此时会创建一个<code>package.json</code>文件，然后创建一个app.js文件。再安装koa的项目依赖：</p> <div class="language- extra-class"><pre class="language-text"><code>yarn install koa 或者npm install koa
</code></pre></div><p>然后在项目目录文件终端下面运行</p> <div class="language- extra-class"><pre class="language-text"><code>node app.js 
</code></pre></div><h2 id="运用koa生成器创建项目"><a href="#运用koa生成器创建项目" class="header-anchor"></a> 运用koa生成器创建项目</h2> <p>生成器：一个方便快速使用的脚手架，首先安装环境依赖：<code>npm install koa-generator -g</code> ，然后再使用下面的命令：</p> <div class="language- extra-class"><pre class="language-text"><code>koa koa_demo 
//创建成功后，进入koa_demo，运行
npm run start  
</code></pre></div><h2 id="koa路由"><a href="#koa路由" class="header-anchor"></a> koa路由</h2> <p>npm install --save koa-router</p> <h2 id="koa-post-请求的数据"><a href="#koa-post-请求的数据" class="header-anchor"></a> koa post 请求的数据</h2> <p>对于POST请求的处理，koa-bodyparser中间件可以把koa2上下文的formData数据解析到ctx.request.body中。
npm install --save koa-bodyparser</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> bodyParser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-bodyparser'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">bodyParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token parameter">ctx</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> 
  ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>body<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="koa静态资源"><a href="#koa静态资源" class="header-anchor"></a> koa静态资源</h2> <p>npm install --save koa-static 主要是用于访问静态资源</p> <h2 id="koa使用session"><a href="#koa使用session" class="header-anchor"></a> koa使用session</h2> <p>npm install koa-session --save
引入：</p> <div class="language- extra-class"><pre class="language-text"><code>const session = require('koa-session');
</code></pre></div><p>设置官方文档提供的中间件：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>app<span class="token punctuation">.</span>keys <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'some secret hurr'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">CONFIG</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
   <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token string">'koa:sess'</span><span class="token punctuation">,</span>   <span class="token comment">//cookie key (default is koa:sess)</span>
   <span class="token literal-property property">maxAge</span><span class="token operator">:</span> <span class="token number">86400000</span><span class="token punctuation">,</span>  <span class="token comment">// cookie的过期时间 maxAge in ms (default is 1 days)</span>
   <span class="token literal-property property">overwrite</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token comment">//是否可以overwrite    (默认default true)</span>
   <span class="token literal-property property">httpOnly</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">//cookie是否只有服务器端可以访问 httpOnly or not (default true)</span>
   <span class="token literal-property property">signed</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>   <span class="token comment">//签名默认true</span>
   <span class="token literal-property property">rolling</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>  <span class="token comment">//在每次请求时强行设置cookie，这将重置cookie过期时间（默认：false）</span>
   <span class="token literal-property property">renew</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>  <span class="token comment">//(boolean) renew session when session is nearly expired,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">session</span><span class="token punctuation">(</span><span class="token constant">CONFIG</span><span class="token punctuation">,</span> app<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//使用</span>
    设置值 ctx<span class="token punctuation">.</span>session<span class="token punctuation">.</span>username <span class="token operator">=</span> <span class="token string">&quot;张三&quot;</span><span class="token punctuation">;</span>
     获取值 ctx<span class="token punctuation">.</span>session<span class="token punctuation">.</span>username
</code></pre></div><h2 id="koa-跨域"><a href="#koa-跨域" class="header-anchor"></a> koa 跨域</h2> <p>koa2-cors安装<code>yarn add koa2-cors -S</code></p> <p>在app.js内添加如下代码</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> cors <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa2-cors'</span><span class="token punctuation">)</span>
<span class="token operator">...</span><span class="token operator">...</span><span class="token punctuation">.</span>
<span class="token comment">// 其他代码</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">cors</span><span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><hr> <h2 id="搭建连接好mongodb的koa2项目"><a href="#搭建连接好mongodb的koa2项目" class="header-anchor"></a> 搭建连接好MongoDB的koa2项目</h2> <p>在最开始已经知道怎么初始化一个项目的情况下，我们接下来进行的是，能在网页中显示找到你保存到数据库的数据。</p> <p>项目文件结构（文件目录结构,命名不严谨，仅供展示）：</p> <div class="language- extra-class"><pre class="language-text"><code>├── koa-demo
│   ├── controller
│   │   └── home.js
│   ├── dbHelper
│   │   └── user.js
│   ├── router.js
│   ├── app.js
│   ├── package-lock.json
│   ├── package.json
│   └── start.js
</code></pre></div><ol><li>确认安装所有项目依赖<div class="language-JavaScript extra-class"><pre class="language-javascript"><code><span class="token comment">// 路由</span>
npm install koa<span class="token operator">-</span>router koa<span class="token operator">-</span>bodyparser <span class="token operator">--</span>save
<span class="token comment">// 解决跨域问题</span>
npm install koa2<span class="token operator">-</span>cors <span class="token operator">--</span>save

<span class="token comment">//以下三个是选择安装的，建议全部安装，都是好东西。</span>
<span class="token comment">//热重启</span>
npm install nodemon <span class="token operator">--</span>save
<span class="token comment">// 支持import模块的引入</span>
npm install babel<span class="token operator">-</span>plugin<span class="token operator">-</span>transform<span class="token operator">-</span>es2015<span class="token operator">-</span>modules<span class="token operator">-</span>commonjs babel<span class="token operator">-</span>register <span class="token operator">--</span>save
<span class="token comment">// mongodb</span>
npm install mongoose <span class="token operator">--</span>save
</code></pre></div></li> <li>热重启配置：在<code>package.json</code>文件添加命令<div class="language- extra-class"><pre class="language-text"><code>  &quot;scripts&quot;: {
     .....
    &quot;start&quot;: &quot;nodemon app.js&quot;
  }
</code></pre></div></li> <li>支持import模块的引入后，在根目录创建<code>start.js</code>,写入<div class="language-JavaScript extra-class"><pre class="language-javascript"><code><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'babel-register'</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span>
    <span class="token punctuation">{</span>
        <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'babel-plugin-transform-es2015-modules-commonjs'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./app.js'</span><span class="token punctuation">)</span>
</code></pre></div>需要再次修改<code>package.json</code>文件的命令<div class="language- extra-class"><pre class="language-text"><code>  &quot;scripts&quot;: {
     .....
    &quot;start&quot;: &quot;nodemon start.js&quot;
  }
</code></pre></div></li> <li>app.js 文件代码添加<div class="language-JavaScript extra-class"><pre class="language-javascript"><code><span class="token operator">...</span><span class="token operator">...</span><span class="token punctuation">.</span>
<span class="token comment">// 引入路由</span>
<span class="token keyword">import</span> router <span class="token keyword">from</span> <span class="token string">'./router'</span>
<span class="token comment">// router</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">...</span><span class="token operator">...</span>
</code></pre></div></li> <li>router.js 文件代码参考<div class="language-JavaScript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-router'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> User <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./controller/home'</span><span class="token punctuation">)</span>
router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> User<span class="token punctuation">.</span>query<span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> router
</code></pre></div></li> <li>控制层文件夹controller，home.js文件代码参考<div class="language-JavaScript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> User <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../dbHelper/user'</span><span class="token punctuation">)</span>
exports<span class="token punctuation">.</span><span class="token function-variable function">query</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> User<span class="token punctuation">.</span><span class="token function">queryUsers</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">let</span> message <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">sumFunction</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">code</span><span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
        <span class="token literal-property property">data</span><span class="token operator">:</span> res <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">message</span><span class="token operator">:</span> message
    <span class="token punctuation">}</span>
    ctx<span class="token punctuation">.</span>response<span class="token punctuation">.</span>body <span class="token operator">=</span> result
<span class="token punctuation">}</span>
</code></pre></div></li> <li>数据层dbHelper文件夹user.js代码参考<div class="language-JavaScript extra-class"><pre class="language-javascript"><code><span class="token comment">// 引入</span>
<span class="token keyword">const</span> MongoClient <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mongodb'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>MongoClient<span class="token punctuation">;</span>
<span class="token keyword">const</span> assert <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'assert'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// mongoDB 链接，假如你数据库要密码则要输入密码，参考官方文档</span>
<span class="token comment">// https://docs.mongodb.com/manual/reference/connection-string</span>
<span class="token keyword">const</span> dbUrl <span class="token operator">=</span> <span class="token string">&quot;mongodb://admin:123456@localhost:27017/admin&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MongoClient</span><span class="token punctuation">(</span>dbUrl<span class="token punctuation">,</span> <span class="token punctuation">{</span> useNewUrlParser<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> dbName <span class="token operator">=</span> <span class="token string">'admin'</span><span class="token comment">//数据库名字</span>
<span class="token keyword">const</span> tableName <span class="token operator">=</span> <span class="token string">'users'</span><span class="token comment">// 表名字</span>
<span class="token comment">/**
 * @desc: 查询所有用户
 */</span>
exports<span class="token punctuation">.</span><span class="token function-variable function">queryUsers</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            client<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                assert<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">const</span> db <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">db</span><span class="token punctuation">(</span>dbName<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">const</span> collection <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span>tableName<span class="token punctuation">)</span><span class="token punctuation">;</span>
                collection<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    assert<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    client<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token function">resolve</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
     <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
</code></pre></div></li></ol> <hr> <p>总结：数据层的和控制层的js，和MongoDB的代码还很生疏，不会写，需要花时间去学习一下。</p></div> <hr> <div class="comment-layout" data-v-6834d650><div id="test" data-v-6834d650></div> <span id="/message/" data-flag-title="留言板" class="leancloud_visitors" style="display:none;" data-v-6834d650><em class="post-meta-item-text" data-v-6834d650>阅读量 </em> <i class="leancloud-visitors-count" data-v-6834d650>10000</i></span></div></article> <div class="sticker vuepress-toc"><div class="vuepress-toc-item vuepress-toc-h2 active"><a href="#windows-mongodb环境配置" title="Windows MongoDB环境配置">Windows MongoDB环境配置</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#macos-mongodb的环境配置" title="macOs MongoDB的环境配置">macOs MongoDB的环境配置</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#koa创建项目" title="koa创建项目">koa创建项目</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#运用koa生成器创建项目" title="运用koa生成器创建项目">运用koa生成器创建项目</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#koa路由" title="koa路由">koa路由</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#koa-post-请求的数据" title="koa post 请求的数据">koa post 请求的数据</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#koa静态资源" title="koa静态资源">koa静态资源</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#koa使用session" title="koa使用session">koa使用session</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#koa-跨域" title="koa 跨域">koa 跨域</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#搭建连接好mongodb的koa2项目" title="搭建连接好MongoDB的koa2项目">搭建连接好MongoDB的koa2项目</a></div></div></div> <div class="footer-layout"><ul class="footer-list"><li><div class="title">关于本站</div> <div class="text">
        MIT Licensed | Copyright © 2022-present Will Wang
      </div> <div class="text"></div></li> <li><div class="title">联系方式</div> <div class="text">邮箱:942345396@qq.com</div> <div class="text"><a href="/message/">留言板:点击留言</a></div></li></ul></div></div></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.34a60fde.js" defer></script><script src="/assets/js/4.969febe7.js" defer></script><script src="/assets/js/34.ab906998.js" defer></script>
  </body>
</html>
